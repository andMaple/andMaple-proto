<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>& Maple Flavor Wheel</title>
  <style>
    body { font-family: sans-serif; padding: 1em; max-width: 600px; margin: auto; }
    select { width: 100%; height: 200px; }
    button { margin-top: .5em; padding: .5em 1em; }
    #result { margin-top: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Pick Your Spices</h1>
  <select id="spiceSelect" multiple></select><br/>
  <button id="genBlend">Generate Blend</button>
  <div id="result"></div>

  <script>
    // 1) Inline spice data
    const spices = [
      { "Spice Name":"Black Peppercorns", "Intensity":7 },
      { "Spice Name":"Crushed Red Pepper", "Intensity":6 },
      { "Spice Name":"New Mexico Chili Powder", "Intensity":5 },
      { "Spice Name":"Chipotle Powder", "Intensity":6 },
      { "Spice Name":"Cinnamon (ground)", "Intensity":4 },
      { "Spice Name":"Ginger (ground)", "Intensity":5 },
      { "Spice Name":"Fennel Seed", "Intensity":3 },
      { "Spice Name":"Cardamom Pods", "Intensity":4 },
      { "Spice Name":"Rosemary (dried)", "Intensity":5 },
      { "Spice Name":"Thyme", "Intensity":4 },
      { "Spice Name":"Oregano", "Intensity":4 },
      { "Spice Name":"Bay Leaves", "Intensity":2 },
      { "Spice Name":"Garlic Powder", "Intensity":6 },
      { "Spice Name":"Onion Powder", "Intensity":5 },
      { "Spice Name":"Mustard Seed", "Intensity":5 },
      { "Spice Name":"Dried Lemon Peel", "Intensity":3 },
      { "Spice Name":"Dried Orange Peel", "Intensity":3 },
      { "Spice Name":"Smoked Paprika", "Intensity":5 },
      { "Spice Name":"Sweet Hungarian Paprika", "Intensity":3 },
      { "Spice Name":"Ground Rosemary", "Intensity":5 }
    ];

    // 2) Render the select list
    const selectEl = document.getElementById('spiceSelect');
    spices.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s["Spice Name"];
      opt.textContent = s["Spice Name"];
      selectEl.appendChild(opt);
    });

    // 3) Hook up the button
    document.getElementById('genBlend').addEventListener('click', async () => {
      const chosen = Array.from(selectEl.selectedOptions).map(o => o.value);
      if (!chosen.length) {
        return document.getElementById('result').textContent = 'Select at least one spice.';
      }
      document.getElementById('result').textContent = 'Generating blend…';

      // 4) Call GPT-4
      const resp = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer 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'
        },
        body: JSON.stringify({
          model: 'gpt-4',
          messages: [
            { role: 'system', content: 'You’re an expert spice blender. Output JSON only.' },
            { role: 'user', content:
              `Given these spices: ${chosen.join(', ')}\n` +
              `Return {"name":string, "breakdown":[{"spice":string,"pct":number}], "notes":string}.`
            }
          ],
          temperature: 0.7,
          max_tokens: 200
        })
      });

      const { choices } = await resp.json();
      let data;
      try {
        data = JSON.parse(choices[0].message.content);
      } catch (e) {
        return document.getElementById('result').textContent = 'Error parsing AI response.';
      }

      // 5) Display the blend
      let out = `Blend Name: ${data.name}\n`;
      data.breakdown.forEach(item => {
        out += `${item.pct}% ${item.spice}\n`;
      });
      out += `Notes: ${data.notes}`;
      document.getElementById('result').textContent = out;
    });
  </script>
</body>
</html>
